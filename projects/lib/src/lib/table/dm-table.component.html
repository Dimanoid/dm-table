<ng-template [ngIf]="noColumns">
    <div class="ngx-dmt-nocolumns"><span></span></div>
</ng-template>
<ng-template [ngIf]="!noColumns">
    <div *ngIf="ctMap" class="ngx-dmt-header-wrapper" [style.margin-right.px]="scrollBarWidth" #headerWrapper>
        <table class="ngx-dmt ngx-dmt-header"
            [ngClass]="tableClass">
            <colgroup>
                <ng-template ngFor let-cid [ngForOf]="colsOrder">
                    <col *ngIf="colsVisibility[cid]" [style.width.px]="resizeColumnId ? colsWidthTmp[cid] : colsWidth[cid]">
                </ng-template>
            </colgroup>
            <thead>
                <tr class="ngx-dmt-header-row"
                    cdkDropList cdkDropListOrientation="horizontal"
                    (cdkDropListDropped)="columnHeaderDrop($event)">
                    <ng-template ngFor let-cid [ngForOf]="colsOrder" let-l="last">
                        <th *ngIf="colsVisibility[cid]"
                            class="ngx-dmt-header-cell"
                            [title]="ctMap[cid].headerTooltip ? ctMap[cid].headerTooltip : ''"
                            [ngClass]="ctMap[cid].headerClass"
                            [class.ngx-dmt-sortable]="ctMap[cid].sortable"
                            [class.ngx-dmt-resizeable]="ctMap[cid].resizeable && !l"
                            [class.ngx-dmt-sorted]="sort && sort.colId == cid"
                            [class.ngx-dmt-sorted-asc]="sort && sort.order > 0"
                            [class.ngx-dmt-sorted-desc]="sort && sort.order < 0"
                            cdkDrag cdkDragLockAxis="x">
                            <div class="ngx-dmt-column-title" (click)="ctMap[cid].sortable ? toggleSort(cid) : null">
                                <!-- {{ resizeColumnIndex > -1 ? colsWidthTmp[i] : colsWidth[i] }} <small class="fw-n">({{ ctMap[cid].minWidth }} - {{ ctMap[cid].maxWidth ? ctMap[cid].maxWidth : 'âˆž' }})</small> -->
                                <ng-container *ngIf="ctMap[cid].headerTpl" [ngTemplateOutlet]="ctMap[cid].headerTpl"></ng-container>
                                <ng-template [ngIf]="!ctMap[cid].headerTpl">{{ ctMap[cid].title }}</ng-template>
                            </div>
                            <div class="ngx-dmt-column-draghandle" cdkDragHandle><i class="ngx-dmt-column-draghandle-icon ngx-dmt-icon-font"></i></div>
                            <div *ngIf="ctMap[cid].sortable" class="ngx-dmt-column-sort-container" (click)="toggleSort(cid)"><i class="ngx-dmt-column-sort-toggle ngx-dmt-icon-font"></i></div>
                            <div *ngIf="ctMap[cid].resizeable && !l" class="ngx-dmt-resizer"
                                [class.ngx-dmt-resizer-dragging]="resizeColumnId == cid"
                                (mousedown)="resizeColumnStart(cid, resizer, $event)" #resizer>
                            </div>
                        </th>
                    </ng-template>
                </tr>
            </thead>
        </table>
    </div>
    <div *ngIf="ctMap" class="ngx-dmt-body-wrapper">
        <div *ngIf="resizerDiv && resizeColumnId" class="ngx-dmt-resizer" [style.left.px]="resizerX"></div>
        <cdk-virtual-scroll-viewport [itemSize]="itemSize" class="ngx-dmt-body-wrapper-inner" (scroll)="scroll($event)">
            <table class="ngx-dmt ngx-dmt-body">
                <colgroup>
                    <ng-template ngFor let-cid [ngForOf]="colsOrder">
                        <col *ngIf="colsVisibility[cid]" [style.width.px]="colsWidth[cid]">
                    </ng-template>
                </colgroup>
                <tbody *ngIf="rows">
                    <tr *cdkVirtualFor="let r of rows; let ri = index">
                        <ng-template ngFor let-cid [ngForOf]="colsOrder" let-i="index">
                            <td *ngIf="colsVisibility[cid]"
                                [ngClass]="ctMap[cid].cellClass"
                                [style.white-space]="ctMap[cid].whitespace">
                                <ng-container *ngIf="ctMap[cid].cellTpl"
                                    [ngTemplateOutlet]="ctMap[cid].cellTpl"
                                    [ngTemplateOutletContext]="{ row: r, ct: ctMap[cid], $implicit: r[cid], ci: i, ri: ri }">
                                </ng-container>
                                <ng-template [ngIf]="!ctMap[cid].cellTpl">{{ r[cid] }}</ng-template>
                            </td>
                        </ng-template>
                    </tr>
                </tbody>
            </table>
        </cdk-virtual-scroll-viewport>
    </div>
    <div *ngIf="ctMap && hasFooter" class="ngx-dmt-footer-wrapper" [style.margin-right.px]="scrollBarWidth">
        <table class="ngx-dmt ngx-dmt-header">
            <colgroup>
                <ng-template ngFor let-cid [ngForOf]="colsOrder">
                    <col *ngIf="colsVisibility[cid]" [style.width.px]="colsWidth[cid]">
                </ng-template>
            </colgroup>
            <tfoot>
                <tr>
                    <ng-template ngFor let-cid [ngForOf]="colsOrder">
                        <td *ngIf="colsVisibility[cid]" [ngClass]="ctMap[cid].footerClass">
                            <ng-container *ngIf="ctMap[cid].footerTpl" [ngTemplateOutlet]="ctMap[cid].footerTpl"></ng-container>
                            <ng-template [ngIf]="!ctMap[cid].footerTpl">&nbsp;</ng-template>
                        </td>
                    </ng-template>
                </tr>
            </tfoot>
        </table>
    </div>
</ng-template>